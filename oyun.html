<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Pong - Neon Atmosphere</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --p1-color: #F1C40F; /* Sarƒ± */
            --p2-color: #E74C3C; /* Kƒ±rmƒ±zƒ± */
            --glow-red: rgba(220, 20, 60, 0.8); 
        }
        
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            /* D√úZELTME BURADA: D√ºz siyah yerine bordo-siyah ge√ßi≈üi */
            background: radial-gradient(circle at center, #2b1010 0%, #000000 100%);
            color: #fff; font-family: 'Montserrat', sans-serif;
            margin: 0; height: 100vh; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* --- MEN√ú --- */
        #menuContainer {
            width: 90%; max-width: 400px;
            background: rgba(20, 10, 10, 0.6); /* Hafif kƒ±zƒ±l cam efekti */
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            backdrop-filter: blur(15px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            z-index: 50;
        }

        h1 {
            margin: 0 0 30px 0;
            color: #fff;
            font-weight: 900; letter-spacing: 2px; text-transform: uppercase;
            text-shadow: 0 0 20px var(--p2-color); /* Ba≈ülƒ±kta hafif kƒ±rmƒ±zƒ± parlama */
        }

        input {
            width: 100%; padding: 15px; margin-bottom: 20px;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1);
            color: #fff; font-size: 1.1rem; text-align: center; font-weight: bold;
            outline: none; border-radius: 8px;
        }

        button {
            width: 100%; padding: 15px; margin-bottom: 15px;
            background: var(--p1-color); color: #000; border: none; border-radius: 8px;
            font-size: 1rem; font-weight: 900; cursor: pointer;
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.3);
            transition: 0.2s;
        }
        button:active { transform: scale(0.96); }
        button.secondary { background: transparent; border: 2px solid #555; color: #ccc; box-shadow: none; }
        
        /* --- OYUN ALANI --- */
        #gameLayer {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            /* Arka planƒ± transparan yap ki body'deki gradient g√∂r√ºns√ºn */
            background: transparent; 
            z-index: 100;
            display: none; 
            align-items: center; justify-content: center;
        }

        canvas {
            max-width: 95%; max-height: 95%;
            /* Canvas i√ßi √ßok hafif transparan siyah */
            background: rgba(0, 0, 0, 0.6); 
            /* ƒ∞STEDƒ∞ƒûƒ∞N GLOW BURADA */
            box-shadow: 0 0 50px var(--glow-red), 0 0 10px var(--glow-red) inset; 
            border: 1px solid rgba(220, 20, 60, 0.4);
            border-radius: 8px;
        }

        /* --- HUD --- */
        #hudLayer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 101; display: none;
        }

        #timer {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            font-size: 2.5rem; font-weight: 900; color: #fff;
            text-shadow: 0 0 15px rgba(255,255,255,0.3);
        }

        .p-name-box {
            position: absolute; top: 25px;
            font-weight: 700; font-size: 1.2rem; text-transform: uppercase;
            letter-spacing: 1px;
        }
        #lblP1 { left: 40px; color: var(--p1-color); text-shadow: 0 0 15px rgba(241, 196, 15, 0.6); }
        #lblP2 { right: 40px; color: var(--p2-color); text-shadow: 0 0 15px rgba(231, 76, 60, 0.6); }

        #emojiBtn {
            position: absolute; bottom: 30px; right: 30px;
            width: 65px; height: 65px; 
            background: rgba(231, 76, 60, 0.15);
            border: 2px solid var(--p2-color); 
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; pointer-events: auto; cursor: pointer;
            box-shadow: 0 0 25px rgba(231, 76, 60, 0.3);
            transition: transform 0.1s;
        }
        #emojiBtn:active { transform: scale(0.9); }

        /* --- MODAL --- */
        #modalOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 200;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .hidden { display: none !important; }
        .text-big { font-size: 3rem; margin: 10px 0; font-weight: 900; letter-spacing: 5px; color: var(--p1-color); }
        .status { margin-top: 10px; font-size: 0.8rem; color: #bbb; }
        
        #rotateMsg { display: none; position: fixed; z-index: 9999; background: #000; width: 100%; height: 100%; top:0; left:0; align-items: center; justify-content: center; flex-direction: column;}
        @media screen and (orientation: portrait) { #rotateMsg { display: flex; } }
    </style>
</head>
<body>

    <div id="rotateMsg">
        <div style="font-size:3rem; color:var(--p1-color);">‚Üª</div>
        <p style="color:white; margin-top:10px;">L√úTFEN TELEFONU YAN √áEVƒ∞R</p>
    </div>

    <div id="menuContainer">
        <h1>NEON PONG</h1>
        
        <div id="pName">
            <input type="text" id="inpName" placeholder="ADINIZ (Max 8)" maxlength="8">
            <button onclick="goModeSelect()">DEVAM ET</button>
        </div>

        <div id="pMode" class="hidden">
            <button onclick="startSingle()">ü§ñ ANTRENMAN (CPU)</button>
            <button class="secondary" onclick="startHost()">üè† ODA KUR</button>
            <button class="secondary" onclick="startJoin()">üîë ODAYA Gƒ∞R</button>
            <button class="secondary" style="border:none; color:#888;" onclick="location.reload()">GERƒ∞</button>
        </div>

        <div id="pHost" class="hidden">
            <p style="color:#ccc;">BU KODU ARKADA≈ûINA VER:</p>
            <div id="displayCode" class="text-big">...</div>
            <div id="hostStatus" class="status">Sunucu bekleniyor...</div>
            <button id="btnStartGame" class="hidden" style="background:#2ecc71; margin-top:15px; box-shadow:0 0 15px #2ecc71;" onclick="hostTriggerStart()">BA≈ûLAT ‚ñ∂</button>
            <button class="secondary" style="margin-top:20px;" onclick="location.reload()">ƒ∞PTAL</button>
        </div>

        <div id="pJoin" class="hidden">
            <p style="color:#ccc;">ODA KODUNU Gƒ∞R:</p>
            <input type="number" id="inpCode" placeholder="1234" style="font-size:2rem; letter-spacing:5px;">
            <button onclick="joinSession()">BAƒûLAN</button>
            <div id="joinStatus" class="status"></div>
            <button class="secondary" style="margin-top:10px;" onclick="location.reload()">GERƒ∞</button>
        </div>
    </div>

    <div id="gameLayer">
        <canvas id="cvs" width="800" height="500"></canvas>
    </div>

    <div id="hudLayer">
        <div id="timer">00:00</div>
        <div id="lblP1" class="p-name-box">P1</div>
        <div id="lblP2" class="p-name-box">P2</div>
        <div id="emojiBtn" onclick="sendHeart()">‚ù§Ô∏è</div>
    </div>

    <div id="modalOverlay">
        <div style="font-size:80px; color:var(--p1-color);">‚ôõ</div>
        <p style="color:#aaa; letter-spacing:2px; margin:0;">KAZANAN</p>
        <h2 id="winName" style="font-size:3rem; margin:10px 0; color:#fff;">-</h2>
        <button style="width:200px;" onclick="location.reload()">TEKRAR</button>
    </div>

<script>
    const PEER_CONF = { config: { iceServers: [ { urls: 'stun:stun.l.google.com:19302' }, { urls: 'stun:global.stun.twilio.com:3478' } ] } };
    const G = { w: 800, h: 500 };
    
    let state = { bx: 400, by: 250, bvx: 5, bvy: 5, p1: 200, p2: 200, s1: 0, s2: 0, time: 90, over: false };
    let role = null; let myName = "OYUNCU"; let oppName = "RAKƒ∞P";
    let peer = null; let conn = null; let timerId = null;
    let particles = []; let texts = [];

    const cvs = document.getElementById('cvs');
    const ctx = cvs.getContext('2d');

    // --- MEN√ú ---
    function goModeSelect() {
        const val = document.getElementById('inpName').value.trim();
        if(val) myName = val.toUpperCase();
        showPage('pMode');
        requestFullScreen();
    }
    function showPage(id) {
        ['pName','pMode','pHost','pJoin'].forEach(p => document.getElementById(p).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }
    function requestFullScreen() { document.documentElement.requestFullscreen?.().catch(()=>{}); }

    // --- GAME LOGIC ---
    function startSingle() { role='single'; oppName="CPU"; startGame(); }
    
    function startHost() {
        role='host'; showPage('pHost');
        const code = Math.floor(Math.random()*9000)+1000;
        document.getElementById('displayCode').innerText = code;
        peer = new Peer("cpong-"+code, PEER_CONF);
        peer.on('open', ()=>{ document.getElementById('hostStatus').innerText="Bekleniyor..."; });
        peer.on('error', ()=>{ startHost(); });
        peer.on('connection', c => { conn=c; document.getElementById('hostStatus').innerText="BAƒûLANDI!"; setupConn(); });
    }
    function hostTriggerStart() { if(conn&&conn.open) { conn.send({t:'START'}); startGame(); } }

    function startJoin() { showPage('pJoin'); }
    function joinSession() {
        role='guest'; document.getElementById('joinStatus').innerText="Aranƒ±yor...";
        peer = new Peer(null, PEER_CONF);
        peer.on('open', ()=>{
            conn = peer.connect("cpong-"+document.getElementById('inpCode').value);
            conn.on('open', ()=>{ document.getElementById('joinStatus').innerText="Baƒülandƒ±!"; setupConn(); });
            setTimeout(()=>{ if(!conn||!conn.open) document.getElementById('joinStatus').innerText="Bulunamadƒ±."; },5000);
        });
    }

    function setupConn() {
        conn.send({t:'NAME', n:myName});
        conn.on('data', d => {
            if(d.t==='NAME') { oppName=d.n; if(role==='host') { document.getElementById('hostStatus').innerText=oppName+" geldi!"; document.getElementById('btnStartGame').classList.remove('hidden'); } }
            else if(d.t==='START') startGame();
            else if(d.t==='MOVE') { if(role==='host') state.p2=d.v; }
            else if(d.t==='SYNC'&&role==='guest') { state=d.s; state.time=d.tm; updateTime(); }
            else if(d.t==='EMOJI') spawnText(d.msg, false);
            else if(d.t==='OVER') endGame(d.w);
        });
    }

    function startGame() {
        document.getElementById('menuContainer').style.display='none';
        document.getElementById('gameLayer').style.display='flex';
        document.getElementById('hudLayer').style.display='block';
        document.getElementById('lblP1').innerText = role==='guest'?oppName:myName;
        document.getElementById('lblP2').innerText = role==='guest'?myName:oppName;
        if(role!=='guest') timerId = setInterval(()=>{ state.time--; if(state.time<=0){state.over=true; finishGame();} },1000);
        requestAnimationFrame(loop);
    }

    function loop() {
        if(state.over) return;
        if(role!=='guest') updatePhys();
        draw();
        if(role==='host'&&conn&&conn.open) conn.send({t:'SYNC', s:state, tm:state.time});
        requestAnimationFrame(loop);
    }

    function updatePhys() {
        state.bx+=state.bvx; state.by+=state.bvy;
        if(role==='single') { let c=state.p2+50; if(c<state.by-20) state.p2+=6; else if(c>state.by+20) state.p2-=6; }
        if(state.by<8||state.by>G.h-8) state.bvy*=-1;
        
        if(state.bx<30 && state.by>state.p1 && state.by<state.p1+100) { state.bvx=Math.abs(state.bvx)*1.05; spawnPart(state.bx,state.by,'#F1C40F'); }
        else if(state.bx<0) { state.s2++; resetBall(); }
        
        if(state.bx>G.w-30 && state.by>state.p2 && state.by<state.p2+100) { state.bvx=-Math.abs(state.bvx)*1.05; spawnPart(state.bx,state.by,'#E74C3C'); }
        else if(state.bx>G.w) { state.s1++; resetBall(); }
        
        state.p1=Math.max(0,Math.min(400,state.p1)); state.p2=Math.max(0,Math.min(400,state.p2));
        updateTime();
    }
    function resetBall() { state.bx=G.w/2; state.by=G.h/2; state.bvx=(Math.random()>0.5?5:-5); state.bvy=(Math.random()*6)-3; }
    function updateTime() { let m=Math.floor(state.time/60), s=Math.floor(state.time%60); document.getElementById('timer').innerText=`${m}:${s<10?'0':''}${s}`; }

    // --- DRAW ---
    function draw() {
        ctx.clearRect(0,0,G.w,G.h);
        
        // Background Text
        ctx.save(); ctx.font="900 180px 'Montserrat'"; ctx.textAlign="center"; ctx.textBaseline="middle";
        ctx.fillStyle="rgba(255,255,255,0.04)"; 
        ctx.fillText(state.s1, G.w*0.25, G.h/2); ctx.fillText(state.s2, G.w*0.75, G.h/2);
        ctx.restore();

        // Middle Line
        ctx.beginPath(); ctx.moveTo(G.w/2,0); ctx.lineTo(G.w/2,G.h); 
        ctx.strokeStyle="rgba(255,255,255,0.05)"; ctx.lineWidth=2; ctx.stroke();

        // Paddles
        ctx.shadowBlur=15; 
        ctx.shadowColor="#F1C40F"; ctx.fillStyle="#F1C40F"; ctx.fillRect(10,state.p1,15,100);
        ctx.shadowColor="#E74C3C"; ctx.fillStyle="#E74C3C"; ctx.fillRect(G.w-25,state.p2,15,100);

        // Ball
        ctx.shadowColor="#fff"; ctx.fillStyle="#fff"; ctx.beginPath(); ctx.arc(state.bx,state.by,8,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0;

        // Effects
        particles.forEach((p,i)=>{ 
            p.x+=p.vx; p.y+=p.vy; p.l-=0.04; ctx.globalAlpha=p.l; ctx.fillStyle=p.c; 
            ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); 
            if(p.l<=0) particles.splice(i,1); 
        }); ctx.globalAlpha=1;

        texts.forEach((t,i)=>{
            t.y--; t.l-=0.01; ctx.globalAlpha=t.l; ctx.font="bold 24px Montserrat"; ctx.fillStyle="#fff"; ctx.textAlign="center"; 
            ctx.fillText(t.msg,t.x,t.y); if(t.l<=0) texts.splice(i,1);
        }); ctx.globalAlpha=1;
    }

    // --- INPUT ---
    window.addEventListener('touchmove',e=>{if(document.getElementById('gameLayer').style.display==='flex'){e.preventDefault(); handle(e.touches[0].clientY);}},{passive:false});
    window.addEventListener('mousemove',e=>{if(document.getElementById('gameLayer').style.display==='flex') handle(e.clientY);});
    function handle(y) {
        let r=cvs.getBoundingClientRect(), sy=G.h/r.height, v=(y-r.top)*sy-50;
        if(role!=='guest') state.p1=v; else if(conn&&conn.open) conn.send({t:'MOVE', v:v});
    }

    function spawnPart(x,y,c) { for(let i=0;i<12;i++) particles.push({x:x,y:y,vx:(Math.random()-0.5)*8,vy:(Math.random()-0.5)*8,l:1,c:c,r:Math.random()*3+1}); }
    function sendHeart() { spawnText("‚ù§Ô∏è A≈ûK",true); if(conn&&conn.open) conn.send({t:'EMOJI', msg:"‚ù§Ô∏è A≈ûK"}); }
    function spawnText(m,mine) { texts.push({x:mine?(role==='host'?150:650):(role==='host'?650:150), y:state.by, msg:m, l:1.5}); }
    function finishGame() { let w=state.s1>state.s2?'P1':(state.s2>state.s1?'P2':'DRAW'); if(conn&&conn.open) conn.send({t:'OVER', w:w}); endGame(w); }
    function endGame(w) { state.over=true; clearInterval(timerId); document.getElementById('modalOverlay').style.display='flex'; document.getElementById('winName').innerText=(w==='P1'?(role==='guest'?oppName:myName):(role==='guest'?myName:oppName)); }
</script>
</body>
</html>
